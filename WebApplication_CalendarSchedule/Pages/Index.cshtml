@page
@model IndexModel
@{
	ViewData["Title"] = "Calendar";
}

<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.css' rel='stylesheet' />
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
	<div id='calendar'></div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			var calendarEl = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendarEl, {
				initialView: 'dayGridMonth',
				eventClick: function (info) {
					openEventModal(info);
				}
			});

			// Функция для загрузки событий из API и добавления их в календарь
			function loadEvents() {
				fetch('/api/events')
					.then(response => response.json())
					.then(data => {

						calendar.getEvents().forEach(event => event.remove());

						data.forEach(event => {
							calendar.addEvent({
								title: event.title,
								start: event.start,
								end: event.end,
								description: event.description,
								typeName: event.eventType.typeName,
								backgroundColor: event.eventType.themeColor
							});
						});
					})
					.catch(error => console.error('Ошибка загрузки данных:', error));
			}


			loadEvents();


			calendar.render();

			//Модальное окно ивента

			function openEventModal(info) {

				var modal = document.createElement('div');
				modal.classList.add('modal', 'fade');
				modal.innerHTML = `
								<div class="modal-dialog modal-dialog-centered">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title">${info.event.title}</h5>
											<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
										</div>
										<div class="modal-body">
											<p><strong>Начало:</strong> ${info.event.start}</p>
											<p><strong>Окончание:</strong> ${info.event.end}</p>
											<p><strong>Описание:</strong> ${info.event.extendedProps.description}</p>
											<p><strong>Тип события:</strong> <span style="color: ${info.event.backgroundColor};">${info.event.extendedProps.typeName}</span></p>
										</div>
									</div>
								</div>`;
				document.body.appendChild(modal);
				var bootstrapModal = new bootstrap.Modal(modal);

				modal.querySelector('.btn-close').addEventListener('click', function () {
					bootstrapModal.hide();
				});
				bootstrapModal.show();
			}
		});

	</script>
</body>
</html>
